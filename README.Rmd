---
title: "Assignment 3"
author: "Patrick D. Schloss"
date: "September 26, 2014"
output:
  html_document:
    keep_md: yes
---

Complete the exercises listed below and submit as a pull request to the [Assignment 3 repository](http://www.github.com/microbialinformatics/assignment03).  Format this document approapriately using R markdown and knitr. For those cases where there are multiple outputs, make it clear in how you format the text and interweave the solution, what the solution is.

Your pull request should only include your *.Rmd and *.md files. You may work with a partner, but you must submit your own assignment and give credit to anyone that worked with you on the assignment and to any websites that you used along your way. You should not use any packages beyond the base R system and knitr.

This assignment is due on October 10th.

------

1.  Generate a plot that contains the different pch symbols. Investigate the knitr code chunk options to see whether you can have a pdf version of the image produced so you can print it off for your reference. It should look like this:

    <img src="pch.png", style="margin:0px auto;display:block" width="500">
```{r}
#creating vectors for PCH value positioning.
xaxis<-seq(1:25)
yaxis<-rep(c(.5),25)
#creating plot with PCH types by their number. This PDF statement makes a PDF file of the plot.
pdf("PCHplot.PDF")
plot(xaxis,yaxis, pch=c(1:25),col="black", lwd=1, main="PCH Symbols", ylab=" ", xlab="PCH Value", axes=F, pin=c(1,4))
#formatting axis
axis(1, at= seq(1,25, by= 1), las=1, tck=.7,col="grey", ylab="n", ps=12,)
axis(1, at=seq(1,25, by=1), col="black")
#adding darker x axis
```{r}
# repeating my code so that I can produce a visible graph on this assignment
plot(xaxis,yaxis, pch=c(1:25),col="black", lwd=1, main="PCH Symbols", ylab=" ", xlab="PCH Value", axes=F, pin=c(1,4))
#formatting axis
axis(1, at= seq(1,25, by= 1), las=1, tck=.7,col="grey", ylab="n", ps=12,)
axis(1, at=seq(1,25, by=1), col="black")
```

```
2.  Using the `germfree.nmds.axes` data file available in this respositry, generate a plot that looks like this. The points are connected in the order they were sampled with the circle representing the beginning ad the square the end of the time course:

    <img src="beta.png", style="margin:0px auto;display:block" width="700">

```{r}
#making germfree file a variable.
germfree<- read.table(file="germfree.nmds.axes", header=T)
#check that germfree has all values and variables
germfree
#sorting by mouse and then day
attach(germfree)
sortedgermfree<-germfree[order(mouse,day),]
detach(germfree)
#making mouse a factor
mousefactor<-as.factor(sortedgermfree$mouse)
mousefactor
sortedgermfree$new.col<-mousefactor
sortedgermfree
#creating plot
plot((sortedgermfree$axis2~sortedgermfree$axis1), type="l", xlim = c(-.2,.6), ylim =c(-.4,0.4), ylab= "NMDS Axis 2", xlab="NMDS Axis 1" , par(mar=c(7,5,1.5,1)), asp=2) 
lines(sortedgermfree$new.col=="337", col="red")

lines(sortedgermfree$mouse=="337", col="black")
lines(sortedgermfree$mouse=="343", col="blue")
lines(sortedgermfree$mouse=="361", col="red")
lines(sortedgermfree$mouse=="387", col="green")
lines(sortedgermfree$mouse=="389", col="brown")

```

3.  On pg. 57 there is a formula for the probability of making x observations after n trials when there is a probability p of the observation.  For this exercise, assume x=2, n=10, and p=0.5.  Using R, calculate the probability of x using this formula and the appropriate built in function. Compare it to the results we obtained in class when discussing the sex ratios of mice.
```{r}
#by hand
n<-factorial(10)
x<-(factorial(2)*factorial(8))
book<-n/x*(.5)^2*(1-.5)^8
book
#with r
withrdbinom<-dbinom(2, 10,.5)
withrdbinom

```
Answer: with the formula on pg 57, the probability was `r book`, with the dbinom function in r the probability was also `r withrdbinom`. When we discussed sex ratios in mice in class, we also calculated this exact probability, as we had the same parameters as in this question (2 males in a litter of 10 mice, with a probability of male = 0.5.)

4.  On pg. 59 there is a formula for the probability of observing a value, x, when there is a mean, mu, and standard deviation, sigma.  For this exercise, assume x=10.3, mu=5, and sigma=3.  Using R, calculate the probability of x using this formula and the appropriate built in function


```{r}
#fraction part
rt<- sqrt(2*pi)
three.rt<-3*rt
check.fx<-((1/three.rt)*exp(-((10.3-5)^2/(2*3^2))))
check.fx
#second part of the question using the built in function for the normal distribution.
builtin<-dnorm(x = 10.3, mean = 5, sd = 3)
builtin
```
Answer: the probability is `r check.fx`

Using the built in function dnorm, the probability is `r builtin` 

5.  One of my previous students, Joe Zackular, obtained stool samples from 89 people that underwent colonoscopies.  30 of these individuals had no signs of disease, 30 had non-cancerous ademonas, and 29 had cancer.  It was previously suggested that the bacterium *Fusobacterium nucleatum* was associated with cancer.  In these three pools of subjects, Joe determined that 4, 1, and 14 individuals harbored *F. nucleatum*, respectively. Create a matrix table to represent the number of individuals with and without _F. nucleatum_ as a function of disease state.  Then do the following:


```{r}
#creating matrix
cancer<- matrix(c(26,29,15,4,1,14), nrow=2, ncol=3, byrow=T)
#adding row and column names
colnames(cancer)<-c("no disease", "cancerous adenomas", "cancer")
rownames(cancer)<-c("no F. nucleatum", "F. nucleatum")
cancer
```
Answer: `r cancer`

    * Run the three tests of proportions you learned about in class using built in R  functions to the 2x2 study design where normals and adenomas are pooled and compared to carcinomas.

```{r}
#creating pooled table for normals + adenomas vs carcinomas
pooled<- matrix(c(55,5,15,14), nrow=2, ncol=2)
#adding row and column names
#want to compare colonization status  by cancer status
colnames(pooled)<-c("no cancer", "cancer")
rownames(pooled)<-c("no F.nucleatum", "F.nucleatum")
pooled
#generating test output
proportion.test<-prop.test(pooled)
proportion.test
fisher.test<-fisher.test(pooled)
fisher.test
chisquare.test<-chisq.test(pooled)
chisquare.test
```
Answer: With all three tests there appears to be a significant difference in the proportion of patients who with *F. nucleatum* by cancer status.  

     * Without using the built in chi-squared test function, replicate the 2x2 study design in the last problem for the Chi-Squared Test...

```{r}
#generating the observed r by c table:
pooled
#generating the expected table
colonization.sums<- margin.table(pooled,1)
colonization.sums
fract.fnuc<-colonization.sums["F.nucleatum"]/sum(colonization.sums)
fract.nofnuc<- 1-fract.fnuc
fract.bac<-c(noFnuc= fract.nofnuc, Fnuc = fract.fnuc)
fract.bac
cancer.sums<-margin.table(pooled,2)
cancer.sums
fract.nocancer<-cancer.sums["no cancer"]/sum(cancer.sums)
fract.cancer<-1-fract.nocancer
fract.disease<-c(healthy= fract.nocancer, cancer= fract.cancer)
fract.disease
expected<-fract.bac %*% t(fract.disease)
expected<-expected*sum(pooled)
expected
#chisquare test to match r, add yates continuity correction
regchisq<- sum((expected-pooled)^2/expected)
regchisq
uncorrected<-sum((abs(expected-pooled)-0.5)^2/(expected))
uncorrected
```
     * Calculate the expected count matrix and calculate the Chi-Squared test statistics. Figure out how to get your test statistic to match Rs default statistic.     
      
Answer: without the continuity correction, my chi suqare test statistic was `r regchisq` ,  After deleting the correction for continuity, my chi square value is `r uncorrected`, this is identical to r's default parameter chisquare test statistic.
 
      *	Generate a Chi-Squared distribution with approporiate degrees of freedom by the method that was discussed in class (hint: you may consider using the `replicate` command)
      
```{r}
df<-(nrow(pooled)-1)*(ncol(pooled)-1)
my.chi.sq<-uncorrected
my.chi.sq
plot(seq(0,20,0.05), dchisq(seq(0,20,0.05), df=df), type="l", xlab="chisquared test statistic", ylab="probability with 1 defree of freedom")
#adding arrows for my chi square test statistic
arrows(x0=my.chi.sq, x1=my.chi.sq, y0=0.4, y1=0.05, lwd=2, col="red")
```
      * Compare your Chi-Squared distributions to what you might get from the appropriate built in R functions
      * Based on your distribution calculate p-values
 
```{r}
p<-replicate(1000, dchisq(pooled, df))
sum(p<0.05)/1000
repPval<-summary(p)
mp<-mean(p)
```

      
      * How does your p-value compare to what you saw using the built in functions? Explain your observations.
  
Answer: With the built in chisquared test with yates continuity correction, the p-value was 5.482e-05, without the yates continuity correction, p-value was 1.632e-05. When I replicated the density using dchisq, the p values I achieved were both smaller and larger than those achieved by the built in r functions:
`r repPval` The mean p value of these functions was `r mp`.

We expect there to be variation in the p values because these probabilities are sampled from the chi squared distribution with 1 degree of freedom and the chi square test examines if the relationship we see between colonization by cancer status is due to random variation or chance alone. However, all p values observed were <0.05, further indicating that we can reject the null hypothesis of no association.  
      
```{r}

```


6\.  Get a bag of Skittles or M&Ms.  Are the candies evenly distributed amongst the different colors?  Justify your conclusion.
